	.include 'dpf.inc'

	.area LCDAUX (CODE)

_lcd_custom_init::
	lcall	lcd_reset
;
	mov	dptr,#_custom_initseq
	ljmp	_lcd_init_by_table

_lcd_custom_setbacklight::
	mov	a,r3
	jnz	doset
	ret
doset:
;
	mov	dptr,#backlight_table
	mov	a,r3
	clr	c
	subb	a,#0xb
	jc	X1536
	clr	c
	mov	a,r3
	subb	a,#0xd
	jnc	X1547
	clr	c
	mov	a,r3
	subb	a,#0x11
	jc	X1558
	mov	a,#0xc5
	lcall	X16e4
	mov	a,#0x35
	lcall	X16e9
	mov	a,#0x26
	lcall	X16e9
	sjmp	X1569
;
X1536:	mov	a,#0xc5
	lcall	X16e4
	mov	a,#0x35
	lcall	X16e9
	mov	a,#0x3e
	lcall	X16e9
	sjmp	X1569
;
X1547:	mov	a,#0xc5
	lcall	X16e4
	mov	a,#0x35
	lcall	X16e9
	mov	a,#0x36
	lcall	X16e9
	sjmp	X1569
;
X1558:	mov	a,#0xc5
	lcall	X16e4
	mov	a,#0x35
	lcall	X16e9
	mov	a,#0x2e
	lcall	X16e9
	sjmp	X1569
;
X1569:	mov	a,r3
	dec	a
	movc	a,@a+dptr
	mov	tmr1perl,#0xff
	mov	tmr1perh,#0x0
	mov	tmr1pwml,a
	mov	tmr1pwmh,#0x0
	ret
;
X16e4:	clr	LCD_A0
	ljmp	otp_lcd_write
;
X16e9:	setb	LCD_A0
	ljmp	otp_lcd_write
;
; If custom contrast handling is needed, uncomment the following label
; and set LCD_CONTRAST_CUSTOM in dpfmodel.h
; r3 contains contrast value (1 .. LCD_MAX_CONTRAST_VALUE)
;
;_lcd_custom_setcontrast::

	.area LCDAUX (CODE)


backlight_table::
	.db	0x19, 0x21, 0x28, 0x30, 0x37, 0x3f, 0x46, 0x55, 0x64
	.db	0x6e, 0x82, 0x96, 0xaa, 0xb9, 0xd2, 0xdf, 0xeb, 0xf5, 0xff

_custom_backlighttbl_len::  .db  . - backlight_table


;contrast_table::
;	.db	If needed, put data for custom contrast handling here
;_custom_contrasttbl_len::  .db  . - contrast_table

_custom_contrasttbl::
	.db	0x26, 0x30, 0x32, 0x34, 0x36, 0x38, 0x3a
_custom_contrasttbl_len::  .db  7

_custom_contrasttbl2::
	.db	0x71, 0x25, 0x91, 0x26, 0xff
_custom_contrasttbl2_len::  .db  5

_custom_contrasttbl2_offsets::
	.db	0x03  ;0x05
_custom_contrasttbl2_offsets_len::  .db  1

;
; NOTE from identify.py: not used
;
;_custom_backlighttbl::
;	.db	0x00, 0x02, 0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e, 0x10, 0x12
;	.db	0x14, 0x16, 0x18, 0x1a, 0x1c, 0x1e, 0x20, 0x24, 0x28, 0x32
;_custom_backlighttbl_len::  .db  20

;_custom_backlighttbl2::
;_custom_backlighttbl2_len::  .db  0

_custom_initseq::
	.db	0x00, 0x10, 0xb0, 0x96, 0x11, 0xb0, 0x96, 0x71, 0x11, 0xb0
	.db	0x96, 0x71, 0xcb, 0x91, 0x11, 0x71, 0xc0, 0x91, 0x26, 0x91
	.db	0x08, 0x71, 0xc1, 0x91, 0x10, 0x71, 0xc5, 0x91, 0x35, 0x91
	.db	0x3e, 0x71, 0x36, 0x91, 0x28, 0x71, 0xb1, 0x91, 0x00, 0x91
	.db	0x16, 0x71, 0xb6, 0x91, 0x0a, 0x91, 0x82, 0x71, 0xc7, 0x91
	.db	0xb5, 0x71, 0xf2, 0x91, 0x00, 0x71, 0x26, 0x91, 0x01, 0x71
	.db	0x3a, 0x91, 0x55, 0x71, 0xe0, 0x91, 0x1f, 0x91, 0x1a, 0x91
	.db	0x18, 0x91, 0x0a, 0x91, 0x0f, 0x91, 0x06, 0x91, 0x45, 0x91
	.db	0x87, 0x91, 0x32, 0x91, 0x0a, 0x91, 0x07, 0x91, 0x02, 0x91
	.db	0x07, 0x91, 0x05, 0x91, 0x00, 0x71, 0xe1, 0x91, 0x00, 0x91
	.db	0x25, 0x91, 0x27, 0x91, 0x05, 0x91, 0x10, 0x91, 0x09, 0x91
	.db	0x3a, 0x91, 0x78, 0x91, 0x4d, 0x91, 0x05, 0x91, 0x18, 0x91
	.db	0x0d, 0x91, 0x38, 0x91, 0x3a, 0x91, 0x1f, 0x71, 0x2a, 0x91
	.db	0x00, 0x91, 0x00, 0x91, 0x00, 0x91, 0xef, 0x71, 0x2b, 0x91
	.db	0x00, 0x91, 0x00, 0x91, 0x01, 0x91, 0x3f, 0x71, 0x34, 0x71
	.db	0x35, 0x71, 0xb4, 0x91, 0x00, 0x71, 0xb7, 0x91, 0x07, 0x71
	.db	0x29, 0xb0, 0x96, 0x71, 0x2c, 0xb0, 0xc8, 0xff
_custom_initseq_len::  .db  168

